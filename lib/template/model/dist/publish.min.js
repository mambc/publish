$(function(){function e(e,o,t,i){i&&(t=t+" "+i);var s=$('<div style="height:25px;">').append($('<div class="legend-color-box">').css({backgroundColor:o})).append($("<span>").css("lineHeight","23px").html(t));e.append(s)}function o(o,t){u.empty(),$("#legend-title").text(" "+Publish.legend),"object"==$.type(o)?$.each(o,function(o,i){e(u,i,t,o)}):e(u,o,t)}function t(e){return{fillColor:e.getProperty("color"),strokeColor:e.getProperty("border"),strokeWeight:e.getProperty("width"),zIndex:e.getProperty("order")}}function i(e){var i=e.target.id,s=p[i];if(s){var n,l,r;if(s.getMap()){s.setMap(null);var a=c.indexOf(i);if(a>=0){c.splice(a,1);var h=c.length;if(h>0){var f=c[h-1];n=Publish.data[f],l=n.select||f,r=n.color,m.text(n.description||""),o(r,l)}else u.empty(),m.empty(),$("#properties").hasClass("in")&&$("#description-title").click(),$("#legends").hasClass("in")&&$("#legend-title").click()}}else n=Publish.data[i],l=n.select||i,r=n.color,m.text(n.description||""),o(r,l),s.setMap(d),c.push(i),$("#properties").hasClass("in")||$("#description-title").click(),$("#legends").hasClass("in")||$("#legend-title").click()}else{g.fadeIn();var b=Publish.path+i+".geojson";$.getJSON(b,function(e){s=new google.maps.Data;var n=Publish.data[i],l=n.select||i,r=n.color;s.addGeoJson(e),s.forEach(function(e){"object"==$.type(r)?e.setProperty("color",r[e.getProperty(l)]):e.setProperty("color",r),e.setProperty("border",n.border),e.setProperty("width",n.width),e.setProperty("order",n.order)}),s.setStyle(t),s.setMap(d),p[i]=s,m.text(n.description||""),o(r,l),c.push(i)}).always(function(){g.fadeOut()})}$("i",this).toggleClass("highlight")}function s(e){var i=[],s=new google.maps.LatLngBounds;g.fadeIn(),e.each(function(e,o){var n=o.id,l=Publish.data[n],r=Publish.path+n+".geojson";i.push($.getJSON(r,function(e){var o=new google.maps.Data,i=l.select||n,r=l.color;o.addGeoJson(e),o.forEach(function(e){"object"==$.type(r)?e.setProperty("color",r[e.getProperty(i)]):e.setProperty("color",r),e.setProperty("border",l.border),e.setProperty("width",l.width),e.getGeometry().forEachLatLng(function(e){s.extend(e)})}),o.setStyle(t),o.addListener("click",function(){$("#modal-report-"+n).modal("show")}),p[n]=o,l.visible&&($("#"+n).children("i").toggleClass("highlight"),o.setMap(d),c.push(n))}))}),$.when.apply($,i).done(function(){d.fitBounds(s);var e=c[0];if(e){var t=Publish.data[e],i=t.select||e,n=t.color;m.text(t.description||""),o(n,i)}}).always(function(){g.fadeOut()})}function n(){google.maps.visualRefresh=!0;var e={minZoom:Publish.minZoom,maxZoom:Publish.maxZoom,mapTypeId:google.maps.MapTypeId[Publish.mapTypeId],mapTypeControl:!0,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU,position:google.maps.ControlPosition.TOP_RIGHT}};Publish.center&&(e.center=new google.maps.LatLng(Publish.center.lat,Publish.center.long)),Publish.zoom&&(e.zoom=Publish.zoom);var o=document.getElementById("map");d=new google.maps.Map(o,e),d.controls[google.maps.ControlPosition.BOTTOM_RIGHT].push($("#footer")[0]),$layers=$("#layers").find(":button"),$layers.click(i),Publish.zoom||google.maps.event.addListenerOnce(d,"idle",function(){s($layers)})}function l(){var e=$(".mini-submenu-left");e.is(":visible")?$("#map").find(".ol-zoom").css("margin-left",0).removeClass("zoom-top-opened-sidebar").addClass("zoom-top-collapsed"):$("#map").find(".ol-zoom").css("margin-left",$(".sidebar-left").width()).removeClass("zoom-top-opened-sidebar").removeClass("zoom-top-collapsed")}function r(){return $(".sidebar").width()==$(window).width()}function a(){r()&&($(".sidebar-left .sidebar-body").fadeOut("slide"),$(".mini-submenu-left").fadeIn())}var d,p={},c=[],u=$("#legend"),g=$("#loader"),m=$("#layer-description");google.maps.event.addDomListener(window,"load",n),$(".sidebar-left .slide-submenu").on("click",function(){var e=$(this);e.closest(".sidebar-body").fadeOut("slide",function(){$(".mini-submenu-left").fadeIn(),l()})}),$(".mini-submenu-left").on("click",function(){var e=$(this);$(".sidebar-left .sidebar-body").toggle("slide"),e.hide(),l()}),$(window).on("resize",l),$("#modal-app-description").modal("show"),a(),l()});